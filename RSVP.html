<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
body {
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    font-size: 10pt;
    cursor: url('CURSORTCPB.png') 0 0, auto;
}

a:hover {
    text-decoration: overline;
    cursor: url('CURSORTCPYELLO.png')0 0, auto;
}

#navdiv {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    width: 50vw;
}

button {
    margin-top: 15px;
    background-color: white;
    border-radius: 0px;
    border: 1px solid black;
    cursor: url('CURSORTCPB.png') 0 0, auto;

}
button:hover {
    margin-top: 15px;
    background-color: black;
    border-radius: 0px;
    color: white;
    border: 1px solid black;
    cursor: url('CURSORTCPYELLO.png')0 0, auto;

}

p:hover {
    text-decoration: overline;
    cursor: url('CURSORTCPYELLO.png')0 0, auto;

}

#info, #times, #email  {
    flex: 1;
    cursor: pointer;
}

#info p, #times p {
    margin: 0;
    line-height: 1.6;
}

#times, #email  {
    display: none;
}

#times.visible, #email.visible {
    display: block;
}

#times p {
    padding: 5px 0;
}

#times p:hover {
    opacity: 0.7;
}

#tos {
    text-decoration: none !important;
}

#email input[type="text"] {
    width: 100%;
    padding: 2px;
    box-sizing: border-box;
    cursor: text;
}   
#email {
flex: 1.5 !important;
}
#email:hover {
    cursor: url('CURSORTCPYELLO.png')0 0, auto;

}

a {
    text-decoration: underline;
    color: black;
}

#message {
    display: none;
    margin-top: 10px;
}

#message.success,
#message.error,
#message.info {
    display: block;
}
    </style>
</head>
<body>
    <div id="navdiv">
        <div id="info">
            <p>TCP <br>
            LIVE-STOCK<br>
            Spring Summer 26
            <br><br>
            45 W 29th St<br>
            New York, NY, United States<br>
            October 11th, 2025
            </p>
        </div>
        <div id="times">
            <p data-time="18:00" class="time-slot">
                18:00 <span class="slots-remaining"></span>
            </p>
            <p data-time="19:30" class="time-slot">
                19:30 <span class="slots-remaining"></span>
            </p>
        </div>
        <div id="email">
            <form id="rsvp-form">
                <input type="text" id="email-input" placeholder="Enter your name" required>
                <button type="submit" id="submit-btn">RSVP</button>
                <p id="tos">To secure attendance, please take a screenshot of the site and email it to <a href="mailto:live.stock.ss26@gmail.com?subject=TCP%2C%20LIVE-STOCK%20RSVP%20CONFIRMATION%2C%20SS25">live.stock.ss26@gmail.com</a>, thank you.</p>
            </form>
            <div id="message"></div>
        </div>
    
        
    </div>
    
    <script>
// RSVP Management System - Connected to Google Sheets
// REPLACE THIS WITH YOUR WEB APP URL FROM GOOGLE APPS SCRIPT
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxdEzmGr85H0L4x9ayMsxwB2PeNo5LcUmb7vgEBP_VeslW7AJeAPlTb23sW7_qU7VCV/exec';

const MAX_SLOTS = 56;

// Data storage (in memory, synced from Google Sheets)
let rsvpData = {
    '18:00': {
        count: 0,
        names: []
    },
    '19:30': {
        count: 0,
        names: []
    }
};

let selectedTime = null;

// DOM elements
const infoDiv = document.getElementById('info');
const timesDiv = document.getElementById('times');
const emailDiv = document.getElementById('email');
const timeSlots = document.querySelectorAll('.time-slot');
const rsvpForm = document.getElementById('rsvp-form');
const emailInput = document.getElementById('email-input');
const submitBtn = document.getElementById('submit-btn');
const messageDiv = document.getElementById('message');

// Initialize: Load current RSVP counts from Google Sheets
async function initializeRSVPCounts() {
    try {
        const response = await fetch(SCRIPT_URL);
        const data = await response.json();
        
        if (data.success) {
            rsvpData['18:00'].count = data.counts['18:00'] || 0;
            rsvpData['19:30'].count = data.counts['19:30'] || 0;
            updateSlotDisplays();
        }
    } catch (error) {
        console.error('Error loading RSVP counts:', error);
        showMessage('Unable to load current availability. Please try again.', 'error');
    }
}

// Update slot availability displays
function updateSlotDisplays() {
    timeSlots.forEach(slot => {
        const time = slot.getAttribute('data-time');
        const remaining = MAX_SLOTS - rsvpData[time].count;
        
        if (remaining <= 0) {
            slot.style.opacity = '0.5';
            slot.style.pointerEvents = 'none';
            slot.querySelector('.slots-remaining').textContent = '(FULL)';
        } else {
            slot.querySelector('.slots-remaining').textContent = '';
        }
    });
}

// Click on info to show times
infoDiv.addEventListener('click', function() {
    timesDiv.classList.add('visible');
});

// Click on a time slot to select it and show email form
timeSlots.forEach(slot => {
    slot.addEventListener('click', function(e) {
        e.stopPropagation();
        
        const time = this.getAttribute('data-time');
        const remaining = MAX_SLOTS - rsvpData[time].count;
        
        // Check if sold out
        if (remaining <= 0) {
            showMessage('This time slot is no longer available. Please select another time.', 'error');
            return;
        }
        
        // Remove previous selection
        timeSlots.forEach(s => s.classList.remove('selected'));
        
        // Select this slot
        this.classList.add('selected');
        selectedTime = time;
        
        // Show email form
        emailDiv.classList.add('visible');
        messageDiv.style.display = 'none';
    });
});

// Handle form submission
rsvpForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!selectedTime) {
        showMessage('Please select a time slot first.', 'error');
        return;
    }
    
    const name = emailInput.value.trim();
    
    if (!name) {
        showMessage('Please enter a valid name.', 'error');
        return;
    }
    
    // Check if slots still available
    if (rsvpData[selectedTime].count >= MAX_SLOTS) {
        showMessage('Sorry, this time slot is no longer available!', 'error');
        updateSlotDisplays();
        return;
    }
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';
    
    try {
        // Submit RSVP to Google Sheets
        const rsvpNumber = await submitRSVP(name, selectedTime);
        
        // Show success message with big number
        showSuccessWithNumber(rsvpNumber, selectedTime, name);
        
        // Reset form
        emailInput.value = '';
        
        // Reload counts and update displays
        await initializeRSVPCounts();
        
    } catch (error) {
        showMessage('An error occurred. Please try again. ' + error.message, 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'RSVP';
    }
});

// Submit RSVP to Google Sheets backend
async function submitRSVP(name, time) {
    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name,
                time: time
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            return data.number;
        } else {
            throw new Error(data.message || 'Submission failed');
        }
        
    } catch (error) {
        throw new Error('Failed to submit RSVP: ' + error.message);
    }
}

// Show success with big number display
function showSuccessWithNumber(number, time, name) {
    // Create overlay
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100vw';
    overlay.style.height = '100vh';
    overlay.style.display = 'flex';
    overlay.style.flexDirection = 'column';
    overlay.style.justifyContent = 'center';
    overlay.style.alignItems = 'center';
    overlay.style.zIndex = '-9999';
    
    // Create number display
    const numberDisplay = document.createElement('div');
    numberDisplay.textContent = number;
    numberDisplay.style.fontSize = '15vw';
    numberDisplay.style.marginBottom = '1px';
    
    // Create time display
    const timeDisplay = document.createElement('div');
    timeDisplay.textContent = time;
    timeDisplay.style.fontSize = '1.2vw';
    timeDisplay.style.marginBottom = '10px';

    
    // Create name display
    const nameDisplay = document.createElement('div');
    nameDisplay.textContent = name;
    nameDisplay.style.fontSize = '1.2vw';
    
    overlay.appendChild(numberDisplay);
    overlay.appendChild(timeDisplay);
    overlay.appendChild(nameDisplay);

    document.body.appendChild(overlay);
    
    // Re-enable submit button
    setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'RSVP';
    }, 2000);
}

// Show message to user
function showMessage(text, type) {
    messageDiv.textContent = text;
    messageDiv.className = type;
    messageDiv.style.display = 'block';
    
    // Re-enable submit button if needed
    if (submitBtn.disabled && type === 'error') {
        setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = 'RSVP';
        }, 1000);
    }
}

// Prevent email div clicks from bubbling
emailDiv.addEventListener('click', function(e) {
    e.stopPropagation();
});

// Initialize on page load
initializeRSVPCounts();
    </script>
</body>
</html>
